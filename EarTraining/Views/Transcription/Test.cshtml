
@{
    ViewBag.Title = "Transcription Test";
}
<h4 class="text-warning">Not yet fully implemented</h4>
<h2>@ViewBag.Title</h2>

<div class="row">
    <div class="col-md-6 card">
        <div>
            <div class="float-left">
                <h4>Drill</h4>
            </div>
            <div class="float-right">
                <span id="spinner" class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true"></span>
                <input type="button" class="btn btn-primary margin-top-5" value="Get a New Transcription" onclick="newTranscription();" />
            </div>
        </div>
        <figure>
            <figcaption>Press the play button to hear the melody</figcaption>
            <audio id="audMelody" controls preload='none'>
                <source src='' type='audio/mpeg'>
            </audio>
        </figure>
        <p>Hover over the below to reveal the melody</p>
        <div class="spoiler" id="transcription"></div>
    </div>
</div>

@section scripts
{
    <script src="~/Scripts/vexflow-min.js"></script>

    <script>
        $(document).ready(function () {
            newTranscription();
        });

        function newTranscription() {
            var request = $.ajax({
                url: rootPath + "Transcription/AudioAndDictation",
                method: "GET"
            });

            request.done(function (data) {
                $('#audMelody').attr('src', rootPath + 'Temp/' + data.src);
                $("#transcription").html("");
                eval(data.theScript);
            });

            request.fail(function (jqXHR, textStatus) {
                consoleAndToastr('There was an error processing the request.\n\n' + textStatus + ': ' + jqXHR.status + ' - ' + jqXHR.statusText + '.', null, 'error');
            });

        }
    </script>
}

