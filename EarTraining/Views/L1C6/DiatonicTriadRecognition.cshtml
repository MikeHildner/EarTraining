@{
    ViewBag.Title = "L1C6 5.4 I IV V vi iii Diatonic Triad Identification";
}

<h2>Level 1 Chapter 6</h2>
<h5>@ViewBag.Title</h5>

<div class="card bg-info text-white">
    <div class="card-body">
        <i class="fa fa-info-circle"></i>
        <span class="pad-left-10">These are selected from the diatonic triad identification questions on page 132.</span>
    </div>
</div>

<div class="row">
    <div class="col-md-6 card">
        @{
            Html.RenderPartial("NewDO");
        }
    </div>
</div>

<div class="row">
    <div class="col-md-6 card">
        <div>
            <div class="float-left">
                <h4>Drill</h4>
            </div>
            <div class="float-right">
                <span id="spinner" class="spinner-border spinner-border-sm text-primary" role="status" aria-hidden="true"></span>
                <input type="button" class="btn btn-primary margin-top-5" value="Get a New Triad" onclick="setAudioSrc()" />
            </div>
        </div>

        <figure>
            <figcaption>Press the play button to hear the triad</figcaption>
            <audio id="audioEx" controls preload='none'>
                <source src='' type='audio/mpeg'>
            </audio>
        </figure>
        <p>Hover over the below to see the triad</p>
        <div class="spoiler" id="triad"></div>
    </div>
</div>

<div class="row">
    <div class="col-md-12">
        <h4>Triads</h4>
    </div>
</div>

<div class="row">
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">I (root)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-0-0" checked />
                    <label class="custom-control-label small" for="cb-include-0-0">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 0, inversion = 0 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">IV (root)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-1-0" checked />
                    <label class="custom-control-label small" for="cb-include-1-0">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 1, inversion = 0 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">V (root)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-2-0" checked />
                    <label class="custom-control-label small" for="cb-include-2-0">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 2, inversion = 0 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">vi (root)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-3-0" checked />
                    <label class="custom-control-label small" for="cb-include-3-0">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 3, inversion = 0 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">iii (root)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-4-0" checked />
                    <label class="custom-control-label small" for="cb-include-4-0">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 4, inversion = 0 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>

    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">I (1st)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-0-1" checked />
                    <label class="custom-control-label small" for="cb-include-0-1">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 0, inversion = 1 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">IV (1st)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-1-1" checked />
                    <label class="custom-control-label small" for="cb-include-1-1">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 1, inversion = 1 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">V (1st)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-2-1" checked />
                    <label class="custom-control-label small" for="cb-include-2-1">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 2, inversion = 1 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">vi (1st)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-3-1" checked />
                    <label class="custom-control-label small" for="cb-include-3-1">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 3, inversion = 1 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">iii (1st)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-4-1" checked />
                    <label class="custom-control-label small" for="cb-include-4-1">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 4, inversion = 1 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">I (2nd)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-0-2" checked />
                    <label class="custom-control-label small" for="cb-include-0-2">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 0, inversion = 2 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">IV (2nd)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-1-2" checked />
                    <label class="custom-control-label small" for="cb-include-1-2">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 1, inversion = 2 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">V (2nd)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-2-2" checked />
                    <label class="custom-control-label small" for="cb-include-2-2">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 2, inversion = 2 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">vi (2nd)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-3-2" checked />
                    <label class="custom-control-label small" for="cb-include-3-2">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 3, inversion = 2 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
    <div class="col-md-4 card">
        <figure>
            <figcaption>
                <div class="float-left">iii (2nd)</div>
                <div class="float-right custom-control custom-checkbox">
                    <input type="checkbox" class="custom-control-input cb-include" id="cb-include-4-2" checked />
                    <label class="custom-control-label small" for="cb-include-4-2">Include in Drills</label>
                </div>
            </figcaption>
            <div class="clearfix"></div>
            <audio id="audio" controls preload='none'>
                <source src='@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName, triadtype = 4, inversion = 2 })' type='audio/mpeg'>
            </audio>
        </figure>
    </div>
</div>

@section  scripts {
    <script>
        $(document).ready(function () {
            setAudioSrc();

            $('.cb-include').change(function () {
            setAudioSrc();
            });
        });

        // Note we're using the controller method from L1C3 because most of the code was already written.
        function setAudioSrc() {
            $('#spinner').show();
            var audioExSrc = '@Url.Action("GetTriadEx", "L1C3", new { doNoteName = ViewBag.Pitch.PitchName })';

            //var triadtype = getRandomInt(0, 4);
            //var inversion = getRandomInt(0, 2);

            // Get the selected chords.
            var selected = $('.cb-include:checkbox:checked');
            // Pick a random one.
            var randElement = selected[Math.floor(Math.random() * selected.length)];
            var randId = $(randElement).attr('id');
            console.log('randId: ' + randId);

            // Parse out the triad type and inversion.
            var tag = randId.replace('cb-include-', '');
            var parts = tag.split('-');
            var triadtype = parseInt(parts[0]);
            var inversion = parseInt(parts[1]);

            audioExSrc = audioExSrc + '&triadtype=' + triadtype + '&inversion=' + inversion;;

            $('#audioEx').attr('src', audioExSrc);

            var msg = '';
            switch (triadtype) {
                case 0:
                    msg = msg + 'I ';
                    break;
                case 1:
                    msg = msg + 'IV ';
                    break;
                case 2:
                    msg = msg + 'V ';
                    break;
                case 3:
                    msg = msg + 'vi ';
                    break;
                case 4:
                    msg = msg + 'iii ';
                    break;
                default:
                    msg = 'triadType ' + triadtype + ' is not supported.';
                    consoleAndToastr(msg);
            }

            switch (inversion) {
                case 0:
                    msg = msg + '(root)';
                    break;
                case 1:
                    msg = msg + '(1st)';
                    break;
                case 2:
                    msg = msg + '(2nd)';
                    break;
                default:
                    msg = 'inversion ' + inversion + ' is not supported.';
                    consoleAndToastr(msg);

            }

            var doInfo = $('#doSpoiler').text();
            var progressionTable = buildProgressionTable(doInfo, msg);
            $('#triad').html(progressionTable);
            $('#spinner').fadeOut("slow");
    }

    </script>
}

